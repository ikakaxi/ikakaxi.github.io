title: 透明状态栏
author: superman
date: 2018-02-07 22:36:44
categories:
- android
tags:
- 状态栏
---

总结备份一下,防止忘记,网上有较多的设置透明状态栏的方法,目前试了很多,个人觉得现在自己使用的这种方式较完美
首先我的项目没有用到ToolBar或者ActionBar,后退标题栏是自己做的,这个后退标题栏自己做也很简单,而且按系统后退键我也处理了,下面直接说怎么做透明标题栏
<!--more-->

######首先,要在自己的项目里添加v7扩展包,然后再做下列操作

1.设置theme
在默认的values下,添加下面的代码
```
<resources>

    <style name="BaseTheme" parent="Theme.AppCompat.Light.NoActionBar"/>

    <style name="ImageTranslucentTheme" parent="BaseTheme">
        <!--通过设置android:windowIsTranslucent属性，表明该窗口是透明的，这样也不会出现白屏或者黑屏。
        但是，它和MainActivity的显示是同步，如果在MainActivity启动的时候，有过多复杂的操作，就会出现在手机中点击了应用程序的图标之后，
        但过两秒才会打开应用程序不好的卡顿体验效果。-->
        <!--<item name="android:windowIsTranslucent">true</item>-->
        <!--让一张图片作为窗口的背景图，使打开MainActivity第一眼看到的界面是一张图片而不是白屏或者黑屏。
        设置这个属性来显示一张背景图还有一个效果就是启动应用程序会感觉非常快，而且与加载MainActivity的contentView是异步的-->
        <!--<item name="android:windowBackground">@android:color/white</item>-->
        <!-- 打开window预览效果(默认是打开的) -->
        <!--item name="android:windowDisablePreview">true</item-->
        <item name="colorPrimary">@color/colorPrimary</item>
        <item name="colorPrimaryDark">@color/colorPrimaryDark</item>
        <item name="colorAccent">@color/colorAccent</item>
        <item name="android:windowBackground">@android:color/white</item>
        <item name="actionBarStyle">@style/ThemeOverlay.AppCompat.Dark.ActionBar</item>
        <item name="android:actionBarStyle">@style/ThemeOverlay.AppCompat.Dark.ActionBar</item>
    </style>

</resources>
```

2.然后添加同级文件夹values-v21,添加下面的代码
```
<resources xmlns:android="http://schemas.android.com/apk/res/android">

    <!--沉浸式状态栏-->
    <style name="ImageTranslucentTheme" parent="BaseTheme">
        <item name="android:windowDrawsSystemBarBackgrounds">true</item>
        <item name="android:windowContentTransitions">true</item>
        <item name="android:windowAllowEnterTransitionOverlap">true</item>
        <item name="android:windowAllowReturnTransitionOverlap">true</item>
        <item name="android:windowSharedElementEnterTransition">@android:transition/move</item>
        <item name="android:windowSharedElementExitTransition">@android:transition/move</item>
        <item name="android:statusBarColor">@android:color/transparent</item>
    </style>

</resources>
```
3.在AndroidManifest.xml里,给Application配置上
```
android:theme="@style/ImageTranslucentTheme"
```
4.在需要透明状态栏的Activity的onCreate方法里添加方法
```
	@Override
	protected void onCreate(Bundle savedInstanceState) {
		requestWindowFeature(Window.FEATURE_NO_TITLE);
		super.onCreate(savedInstanceState);
		StatusBarCompat.compat(this, getResources().getColor(R.color.back_title_bg));
	}
```
back_title_bg是我自己定义的颜色,在color.xml文件里配置的,这么做就可以实现透明状态栏了,这里有一些值应该不需要配置也可以,等以后有时间再研究一下,下面附上StatusBarCompat类的源码
```

import android.annotation.TargetApi;
import android.app.Activity;
import android.graphics.Color;
import android.os.Build;
import android.support.annotation.ColorInt;
import android.view.View;
import android.view.ViewGroup;

import cn.finalteam.toolsfinal.DeviceUtils;

public class StatusBarCompat {

	private static final int INVALID_VAL = -1;
	private static final int COLOR_DEFAULT = Color.parseColor("#20000000");

	@TargetApi(Build.VERSION_CODES.LOLLIPOP)
	public static void compat(Activity activity, @ColorInt int statusColor) {
		ViewGroup contentView = (ViewGroup) activity.findViewById(android.R.id.content);
		View childAt = contentView.getChildAt(0);
		childAt.setFitsSystemWindows(true);
		//当前手机版本为5.0及以上
		if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.LOLLIPOP) {
			if (statusColor != INVALID_VAL) {
				activity.getWindow().setStatusBarColor(statusColor);
			}
			return;
		}

		//当前手机版本为4.4-5.0
		if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.KITKAT && Build.VERSION.SDK_INT < Build.VERSION_CODES.LOLLIPOP) {
			int color = COLOR_DEFAULT;
			if (statusColor != INVALID_VAL) {
				color = statusColor;
			}
			//根布局添加占位状态栏
			ViewGroup decorView = (ViewGroup) activity.getWindow().getDecorView();
			View statusBarView = new View(activity);
			ViewGroup.LayoutParams lp = new ViewGroup.LayoutParams(ViewGroup.LayoutParams.MATCH_PARENT,
					DeviceUtils.getStatusBarHeight(activity));
			statusBarView.setBackgroundColor(color);
			decorView.addView(statusBarView, lp);
		}
	}

	public static void compat(Activity activity) {
		compat(activity, INVALID_VAL);
	}

}

```

其中用到一个开源项目的类,附上地址
https://github.com/pengjianbo/ToolsFinal
只有一个地方用到了,自己找一下替代方法就不用引入这个类库了